---
category: network
cover: https://cdn.pixabay.com/photo/2023/04/13/09/56/alps-7922246_640.jpg
---

# SSE

SSE（Server-Sent Events）是一种用于实现服务器主动向客户端推送数据的技术，也被称为“事件流”（Event Stream）。它基于 HTTP 协议，利用了其长连接特性，在客户端与服务器之间建立一条持久化连接，并通过这条连接实现服务器向客户端的实时数据推送。

SSE 是 WebSocket 的一种轻量代替方案，一般来说 HTTP 是没有办法做到服务器推送的，当服务端向客户端声明接下来要下发的内容的时候，客户端就会保持连接打开，SSE 就是利用这种原理，过程基本如下：

- 客户端向服务器发送一个 GET 请求，带有指定的 header，表示可以接收事件流类型，并禁用任何的事件缓存。
- 服务器返回一个响应，带有指定的 header，表示事件的媒体类型和编码，以及使用分块传输编码（chunked）来流式传输动态生成的内容。
- 服务器在有数据更新时，向客户端发送一个或多个名称：值字段组成的事件，由单个换行符分隔。事件之间由两个换行符分隔。服务器可以发送事件数据、事件类型、事件 ID 和重试时间等字段。
- 客户端使用 EventSource 接口来创建一个对象，打开连接，并订阅 onopen、onmessage 和 onerror 等事件处理程序来处理连接状态和接收消息。
- 客户端可以使用 GET 查询参数来传递数据给服务器，也可以使用 close 方法来关闭连接。

在请求头和响应头设置 `ACCEPT: text/event-stream` 是实现 SSE 的关键。

## SSE 与 Socket 的区别

两者都可以实现服务端向客户端发送数据

1. 实现方式

SSE 基于 HTTP 协议，利用长连接特性通过浏览器发送一个 HTTP 请求，建立持久化连接，WebSocket 是通过特殊的升级协议（HTTP/1.1 Upgrade 或者 HTTP/2）建立新的 TCP 连接，与传统 HTTP 连接不同

2. 数据格式

SSE 可传输文本、二进制格式数据，但只支持服务端向客户端推送
WebSocket 支持双向数据流，并且没有消息大小限制

3. 连接状态

SSE 有三种：已连接、连接中、已断开，连接状态是由浏览器维护，客户端无法手动关闭或者重新打开连接
WebSocket 可以手动打开、关闭、重连

4. 兼容性

SE 是标准的 Web API，可以在大部分现代浏览器和移动设备上使用。老的浏览器则需要通过 polyfill 库进行兼容，WebSocket 在老版本 Android 手机上存在兼容性问题，需要使用一些特殊的 API 进行处理

5. 安全性

SSE 基于 HTTP 协议，风险相对较低，WebSocket 则需要通过额外的安全措施（SSL/TLS 加密）来确保数据传输的安全性，避免被窃听一级篡改
