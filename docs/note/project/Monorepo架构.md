---
category: project
cover: https://cdn.pixabay.com/photo/2017/10/05/09/05/railway-2818748_640.jpg
---

# Monorepo æ¶æ„

## Monorepo ä»‹ç»

`Monorepo`æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘æ¶æ„ï¼Œå¯ä»¥å°†å¤šä¸ªç›¸å…³çš„ä»£ç æˆ–è€…ç»„ä»¶å­˜å‚¨åœ¨ä¸€ä¸ªä»£ç ä»“åº“ä¸­ï¼Œåœ¨è¿™ä¸ªæ¶æ„ä¸­æ¯ä¸€ä¸ªé¡¹ç›®å’Œç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªç›®å½•ã€‚

`npm`ã€`yarn`ã€`pnpm` è¿™äº›åŒ…ç®¡ç†å·¥å…·æ˜¯ç”¨æ¥å®‰è£…ä¾èµ–ã€ç®¡ç†é¡¹ç›®ä¾èµ–ã€å‘å¸ƒåŒ…ï¼Œä»–ä»¬éƒ½æä¾›å¯¹å·¥ä½œåŒºï¼ˆ`workspace`ï¼‰çš„æ”¯æŒ ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªä»£ç ä»“åº“ä¸­ç®¡ç†å¤šä¸ªé¡¹ç›®æˆ–åŒ…ï¼Œä»è€Œæ— éœ€å¤šä¸ªä»£ç ä»“åº“ã€‚

> åŒ…ç®¡ç†å·¥å…·é€šè¿‡ workspace åŠŸèƒ½æ¥æ”¯æŒ Monorepo æ¨¡å¼ï¼ŒWorkspace æ˜¯æŒ‡åœ¨ä¸€ä¸ªä»£ç åº“ä¸­ç®¡ç†å¤šä¸ªç›¸å…³é¡¹ç›®æˆ–æ¨¡å—çš„èƒ½åŠ›ã€‚

## ä¸ºä»€ä¹ˆè¯´ pnpm æ›´é€‚åˆ Monorepoï¼Ÿ

1. ç£ç›˜ç©ºé—´æ•ˆç‡ï¼š

- pnpm é€šè¿‡ç¡¬é“¾æ¥å’Œå†…å®¹å¯»å€å­˜å‚¨ï¼ˆContent-Addressable Storageï¼‰å®ç°äº†æé«˜çš„ç£ç›˜ç©ºé—´æ•ˆç‡ã€‚åœ¨ Monorepo ä¸­ï¼Œå¤šä¸ªé¡¹ç›®å¯èƒ½å…±äº«ç›¸åŒçš„ä¾èµ–é¡¹ã€‚pnpm ç¡®ä¿è¿™äº›ä¾èµ–é¡¹åœ¨ç£ç›˜ä¸Šåªå­˜å‚¨ä¸€æ¬¡ï¼Œå¹¶é€šè¿‡ç¡¬é“¾æ¥åœ¨å¤šä¸ªé¡¹ç›®ä¸­å…±äº«ï¼Œä»è€Œæ˜¾è‘—èŠ‚çœäº†ç£ç›˜ç©ºé—´ã€‚

2. è§£å†³å¹½çµä¾èµ–é—®é¢˜ï¼š

- å¹½çµä¾èµ–æ˜¯æŒ‡åœ¨ npm æˆ– yarn çš„æŸäº›ç‰ˆæœ¬ä¸­ï¼Œå³ä½¿ä¸€ä¸ªä¾èµ–é¡¹åœ¨`package.json`ä¸­æœªè¢«æ˜ç¡®å£°æ˜ï¼Œä¹Ÿå¯èƒ½å› ä¸ºå…¶ä»–ä¾èµ–é¡¹é—´æ¥åœ°åŒ…å«è€Œè¢«å¼•å…¥é¡¹ç›®ä¸­ã€‚è¿™å¯èƒ½å¯¼è‡´é¡¹ç›®åœ¨ä¸åŒç¯å¢ƒä¸‹è¡¨ç°ä¸ä¸€è‡´ã€‚pnpm é€šè¿‡å…¶ç‹¬ç‰¹çš„ä¾èµ–è§£æå’Œå®‰è£…æœºåˆ¶ï¼Œæœ‰æ•ˆåœ°è§£å†³äº†è¿™ä¸€é—®é¢˜ï¼Œç¡®ä¿é¡¹ç›®çš„ä¾èµ–é¡¹æ¸…æ™°ã€ä¸€è‡´ã€‚

3. æ›´å¥½çš„ä¾èµ–ç®¡ç†ï¼š

- åœ¨ Monorepo ä¸­ï¼Œpnpm å…è®¸é¡¹ç›®ä¹‹é—´å…±äº«ç›¸åŒçš„ä¾èµ–é¡¹ç‰ˆæœ¬ï¼Œä»è€Œå‡å°‘äº†ç‰ˆæœ¬å†²çªå’Œä¸å¿…è¦çš„é‡å¤å®‰è£…ã€‚æ­¤å¤–ï¼Œpnpm è¿˜æä¾›äº†æ›´ç²¾ç»†çš„ä¾èµ–ç®¡ç†åŠŸèƒ½ï¼Œå¦‚é”æ–‡ä»¶ï¼ˆ`pnpm-lock.yaml`ï¼‰æ¥ç¡®ä¿å®‰è£…çš„ä¾èµ–é¡¹ç‰ˆæœ¬ä¸€è‡´æ€§å’Œå¯é‡å¤æ€§ã€‚

4. æ›´å¿«çš„å®‰è£…é€Ÿåº¦ï¼š

- ç”±äº pnpm é‡‡ç”¨äº†å†…å®¹å¯»å€å­˜å‚¨å’Œç¡¬é“¾æ¥æŠ€æœ¯ï¼Œå®ƒé€šå¸¸æ¯” npm å’Œ yarn å…·æœ‰æ›´å¿«çš„å®‰è£…é€Ÿåº¦ã€‚åœ¨ Monorepo ä¸­ï¼Œè¿™æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥æ›´å¿«åœ°è®¾ç½®å¼€å‘ç¯å¢ƒå¹¶å¼€å§‹å·¥ä½œã€‚

5. ä¸ Monorepo çš„ååŒå·¥ä½œï¼š

- pnpm ä¸ Monorepo çš„æ¦‚å¿µå’Œå·¥å…·ï¼ˆå¦‚ Lernaã€Yarn Workspaces ç­‰ï¼‰ç´§å¯†é›†æˆï¼Œæä¾›äº†æ›´å¥½çš„æ”¯æŒå’ŒååŒå·¥ä½œä½“éªŒã€‚ä¾‹å¦‚ï¼Œåœ¨ Monorepo ä¸­ï¼Œpnpm å¯ä»¥è½»æ¾å¤„ç†è·¨é¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¹¶å…è®¸å¼€å‘äººå‘˜åœ¨ä¸åŒé¡¹ç›®ä¹‹é—´æ— ç¼åˆ‡æ¢ã€‚

6. å®‰å…¨æ€§ï¼š

- pnpm é€šè¿‡å…¶ç‹¬ç‰¹çš„ä¾èµ–è§£æå’Œå®‰è£…æœºåˆ¶ï¼Œå‡å°‘äº†æ½œåœ¨çš„å®‰å…¨é£é™©ã€‚ä¾‹å¦‚ï¼Œç”±äº pnpm åœ¨ç£ç›˜ä¸Šåªå­˜å‚¨ä¸€æ¬¡ä¾èµ–é¡¹ï¼Œå› æ­¤å‡å°‘äº†æ¶æ„ä»£ç æ³¨å…¥çš„å¯èƒ½æ€§ã€‚æ­¤å¤–ï¼Œpnpm è¿˜æ”¯æŒä½¿ç”¨ HTTPS åè®®ä»å®‰å…¨çš„æºè·å–ä¾èµ–é¡¹ï¼Œè¿›ä¸€æ­¥æé«˜äº†é¡¹ç›®çš„å®‰å…¨æ€§ã€‚

åŒ…ç®¡ç†å·¥å…·ä¸ monorepo çš„å…³ç³»åœ¨äºå®ƒä»¬å¯ä»¥ä¸º monorepo æä¾›ä¾èµ–å®‰è£…ä¸ä¾èµ–ç®¡ç†çš„æ”¯æŒï¼Œå€ŸåŠ©è‡ªèº«å¯¹ workspace çš„æ”¯æŒï¼Œå…è®¸åœ¨ monorepo ä¸­çš„ä¸åŒå­é¡¹ç›®ä¹‹é—´å…±äº«ä¾èµ–é¡¹ï¼Œå¹¶æä¾›ä¸€ç§ç®¡ç†è¿™äº›å…±äº«ä¾èµ–é¡¹çš„æ–¹å¼ï¼Œè¿™å¯ä»¥ç®€åŒ–ä¾èµ–é¡¹ç®¡ç†å’Œæ„å»ºè¿‡ç¨‹ï¼Œå¹¶æé«˜å¼€å‘æ•ˆç‡ã€‚

### Monorepo æ¶æ„æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ

- **ä»£ç å¤ç”¨**

  ç”±äºé¡¹ç›®å…±äº«åŒä¸€ä¸ªä»£ç åº“ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°æŠ½ç¦»å‡ºå…±ç”¨çš„ä¸šåŠ¡ç»„ä»¶æˆ–å·¥å…·ï¼Œå¹¶é€šè¿‡ TypeScriptã€Lerna æˆ–å…¶ä»–å·¥å…·è¿›è¡Œä»£ç å†…å¼•ç”¨ï¼Œé¿å…äº†åœ¨ä¸åŒé¡¹ç›®ä¸­é‡å¤ç¼–å†™ç›¸åŒåŠŸèƒ½ä»£ç çš„é—®é¢˜ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚

- **ä¾èµ–å¤ç”¨**

  é¡¹ç›®ä¹‹é—´çš„å¼•ç”¨è·¯å¾„å†…åŒ–äºå•ä¸€ä»“åº“ï¼Œä½¿å¾—å½“æŸä¸ªé¡¹ç›®çš„ä»£ç ä¿®æ”¹åï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿½è¸ªå…¶å½±å“çš„æ˜¯å…¶ä»–å“ªäº›é¡¹ç›®ã€‚æ­¤å¤–ï¼Œé€šè¿‡å·¥å…·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç‰ˆæœ¬ä¾èµ–ç®¡ç†å’Œç‰ˆæœ¬å·è‡ªåŠ¨å‡çº§ï¼Œç¡®ä¿æ‰€æœ‰é¡¹ç›®éƒ½ä½¿ç”¨æœ€æ–°çš„ä»£ç ï¼Œé¿å…ç‰ˆæœ¬æ›´æ–°ä¸åŠæ—¶çš„é—®é¢˜ã€‚

- **æ˜“äºé‡æ„**

  Monorepo æ¶æ„ä½¿å¾—èƒ½å¤Ÿæ˜ç¡®çŸ¥é“ä»£ç çš„å½±å“èŒƒå›´ï¼Œå¹¶ä¸”å¯ä»¥å¯¹è¢«å½±å“çš„é¡¹ç›®è¿›è¡Œç»Ÿä¸€çš„æµ‹è¯•ï¼Œæœ‰åˆ©äºä¸æ–­ä¼˜åŒ–ä»£ç ã€‚

- **é›†ä¸­ç®¡ç†**

  åœ¨ Monorepo æ¶æ„ä¸­ï¼Œä¸åŒçš„å‰ç«¯é¡¹ç›®éƒ½åœ¨åŒä¸€ä¸ªä»£ç åº“ä¸­ï¼Œæ–¹ä¾¿ç®¡ç†å’Œç›‘æ§ã€‚è¿™ä¸€ç‚¹åœ¨éœ€è¦åŒæ—¶å¯¹å¤šä¸ªç‰ˆæœ¬è¿›è¡Œä¿®æ”¹å’Œç»´æŠ¤çš„æƒ…å†µä¸‹å°¤ä¸ºé‡è¦ã€‚

å‰ç«¯çš„ Monorepo å¦‚ä½•å®ç°å‘¢ï¼Ÿé‚£æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å§

## ä½¿ç”¨ pnpm æ„å»º Monorepo é¡¹ç›®

ä½¿ç”¨ `pnpm` æ­å»ºå‰ç«¯ Monorepo é¡¹ç›®æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå› ä¸º `pnpm` æä¾›äº†ä¸€ä¸ªé«˜æ•ˆä¸”èŠ‚çœç©ºé—´çš„åŒ…ç®¡ç†æ–¹å¼ã€‚

7. **ç¯å¢ƒå®‰è£…**

ç¡®ä¿ä½ å®‰è£…äº† Node.js å’Œ npmã€‚

å®‰è£… pnpm

```Shell
npm i pnpm -g
```

8. **åˆå§‹åŒ– Monorepo é¡¹ç›®**

åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œå¹¶åˆå§‹åŒ–`package.json`

```Shell
npm init -y
```

åˆ›å»ºä¸‹å›¾æ‰€ç¤ºé¡¹ç›®ç»“æ„å¹¶åˆ†åˆ«åˆå§‹åŒ–`package.json`

![](http://tuchuang.niubin.site/image/project-20240511-1.png)

ä½†æ˜¯æ³¨æ„é™¤äº†æ ¹ç›®å½•çš„`package.json`ï¼Œå…¶ä»–çš„`package.json`çš„`name`éœ€è¦æ”¹ä¸ºè¿™ç§

```JSON
{
"name": "@pnpm-monorepo/project1",
"version": "1.0.0",
"description": "",
"main": "index.js",
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1"
},
"keywords": [],
"author": "",
"license": "ISC"
}
```

9. **è®¾ç½® workspaces**

æœ‰å¤šç§è®¾ç½®å·¥ä½œç©ºé—´çš„æ–¹æ³•ï¼š

- ç¬¬ä¸€ç§ï¼š åœ¨ package.json æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª`workspaces`å­—æ®µæ¥æŒ‡å®šä½ çš„ Monorepo é¡¹ç›®åŒ…å«å“ªäº›åŒ…ï¼Œä½ å¯ä»¥æŒ‡å®šå…·ä½“åŒ…çš„è·¯å¾„

```JSON
{
"name": "my-monorepo",
"version": "1.0.0",
"private": true,
"workspaces": [
  "packages/**",
  "project3"
]
}
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰çš„åŒ…éƒ½æ”¾åœ¨ `packages` ç›®å½•ä¸‹ã€‚

- ç¬¬äºŒç§ï¼šä½¿ç”¨`pnpm-workspace.yaml`æ–‡ä»¶

```YAML
packages:
- packages/**
- project3
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå°† packages å’Œ example é¡¹ç›®éƒ½æ”¾åœ¨ `packages` ç›®å½•ä¸‹ã€‚

- ç¬¬ä¸‰ç§ï¼šä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°

ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥æŒ‡å®šå·¥ä½œç©ºé—´çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `pnpm-workspace.yaml` æ–‡ä»¶

```Shell
pnpm install --recursive packages/**
```

> è¿™ç§ä¸€æ¬¡åªèƒ½æ·»åŠ ä¸€ç§

10. å°†æ‰€æœ‰é¡¹ç›®æ·»åŠ è¿›å·¥ä½œç©ºé—´

```Shell
pnpm i @pnpm-monorepo/project1 -w
```

![](http://tuchuang.niubin.site/image/project-20240511-2.png)

è¿™æ—¶å€™å°±ä¼šå‘ç°æ ¹è·¯å¾„ä¸‹çš„`package.json`å¤šäº†ä»¥ä¸‹ä¸œè¥¿

![](http://tuchuang.niubin.site/image/project-20240511-3.png)

æˆ‘ä»¬è¯•ç€åœ¨ project1 ä¸­åˆ›å»ºä¸€ä¸ª js æ–‡ä»¶å¹¶å¯¼å‡ºä¸€ä¸ªæ–¹æ³•

![](http://tuchuang.niubin.site/image/project-20240511-4.png)

æˆ‘ä»¬åœ¨ project3 ä¸‹é¢åˆ›å»º vue é¡¹ç›®ï¼Œå¼•å…¥ project1 å¯¼å‡ºçš„æ–¹æ³•

![](http://tuchuang.niubin.site/image/project-20240511-5.png)

ä¿®æ”¹ project3 å’Œæ ¹ç›®å½•çš„`package.json`

```JSON
{
"name": "@pnpm-monorepo/project3",
"version": "1.0.0",
"description": "",
"main": "index.js",
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "dev": "vite --port 5555"
},
"keywords": [],
"author": "",
"license": "ISC"
}
```

```JSON
{
"name": "pnpm-monorepo",
"version": "1.0.0",
"description": "",
"main": "index.js",
"scripts": {
  "test": "echo \"Error: no test specified\" && exit 1",
  "dev": "pnpm -C project3 dev"
},
"keywords": [],
"author": "",
"license": "ISC",
"dependencies": {
  "@pnpm-monorepo/project1": "workspace:^",
  "@pnpm-monorepo/project2": "workspace:^",
  "@pnpm-monorepo/project3": "workspace:^",
  "@vitejs/plugin-vue": "^5.0.4",
  "vite": "^5.2.11",
  "vue": "^3.4.27"
}
}
```

åœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œ npm run dev è¿è¡Œé¡¹ç›®ï¼Œæ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹

![](http://tuchuang.niubin.site/image/project-20240511-6.png)

å¤§åŠŸå‘Šæˆ ğŸ‰
